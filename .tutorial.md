## Getting started

Depending on the platform setup, the asset may initialize automatically or may need to be manually executed. To manually execute the asset, run the command `./gcp-ce-vpc.sh` on the terminal.

When you run the script, it sets up the pre-requisite automation tools behind the scenes. 

Please be patient, and allow a few seconds for the lab to initialize. 

You will be prompted to enter any key to continue once the initialization process is complete.

If the tutorial is not displayed automatically, enter `0` below the `What additional steps do you want to perform...` prompt.

There are 3 modes of operation. 

Change the mode by selecting step `m`, and enter your preference by selecting an option from the list below:

- `y` to preview configuration or commands.
- `n` to execute commands in the create mode.
- `d` to delete resources in the delete mode.

Click the **START** button below to continue to the next page.

## Selecting a project

You need to select a project for this lab.

*Hint: You should be the Owner or Editor of this project. We recommend deleting the project at the end of the lab or using the `d` option to delete provisioned resources and avoid incurring additional costs.*

Change the mode by selecting step `m`, and select the create mode by entering `n` at the prompt.

If prompted for a code, enter a valid code. For help, contact `support@techequity.cloud`.

Click the **NEXT** button to continue.

## Sign in

You need to authenticate to `gcloud` to complete the lab.

When prompted to authenticate, enter `y`, click the link displayed, sign-in using your Google Cloud account, and click the `Allow` button to grant permissions to Google Cloud SDK. 

Click the `Copy` button to copy the authorization code. 

Return to the cloud shell terminal and paste the authorization code into the prompt to authenticate to cloud shell.

When prompted to change the project from `NOT_SET`, enter `y` and enter your project ID. 

Enter any key at the `$` prompt to return to the menu, and click the **NEXT** button to continue.

## Configure Cloud VPC, Cloud IAP, Cloud NAT and Private Google Access

This asset enables you to configure Cloud VPC, Cloud IAP, Cloud NAT and Private Google Access.

**Time to complete**: About 60 minutes

**Prerequisites**: You need Project Owner or Editor Role.

### Outline

This asset enables you to perform the following activities:

 - Enable APIs
 - Create VPC networks
 - Create VPC Nework firewall rules
 - Create VM instances
 - Explore connectivity between VM instances
 - Explore a VM instance with multiple network interfaces
 - Configure Identity Aware Proxy
 - Configure Cloud NAT
 - Update VM with private IP
 - Create Cloud Storage bucket
 - Configure Private Google Access
 - Copy content of Cloud Storage bucket to VM with private IP

Click the **NEXT** button to continue.

## Step 0: Launch step by step guide

Use this option to launch an interactive step by step guide. 

If new to this experience, follow the guide carefully. 

As your experience grows, the need to refer to this guide will diminish, as the lab experience is intuitive.

To enable APIs, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 1: Enable APIs

You need to enable the APIs in the project to perform the required tasks. 

You only need to do this once for your project. 

Enter `1` at the `additional steps to perform` prompt to enable the API.  

Note the list of APIs enabled.

To create virtual machine instances and firewall rules, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 2 Create VPC networks

Enter `2` at the `additional steps to perform` prompt to create VPC networks. 

Note the comments describing each command, and the parameters.

Navigate to `https://console.cloud.google.com/networking/networks/list?project={{project-id}}` to explore VPC networks on the console.

To create VPC Nework firewall rules, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 3: Create VPC Nework firewall rules

Enter `3` at the `additional steps to perform` prompt to create VPC Nework firewall rules.

Note the comments associated with each command, and step through the commands.

Navigate to `https://console.cloud.google.com/networking/firewalls/list?project={{project-id}}` to explore firewall rules on the console.

To create VM instances, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 4: Create VM instances

Enter `4` at the `additional steps to perform` prompt to create VM instances.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instances?project={{project-id}}` to explore virtual machine instances on the console.

To explore connectivity between VM instances, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 5: Explore connectivity between VM instances

Enter `5` at the `additional steps to perform` prompt to explore connectivity between VM instances.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instances?project={{project-id}}` to explore virtual machine instances on the console.

To explore a VM instance with multiple network interfaces, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 6: Explore a VM instance with multiple network interfaces

Enter `6` at the `additional steps to perform` prompt to explore a VM instance with multiple network interfaces.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instances?project={{project-id}}` to explore virtual machine instances on the console.

To configure Identity Aware Proxy, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 7: Configure Identity Aware Proxy

Enter `7` at the `additional steps to perform` prompt to configure Identity Aware Proxy.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/security/iap?project={{project-id}}` to explore secret manager.

To configure Cloud NAT, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 8: Configure Cloud NAT

Enter `8` at the `additional steps to perform` prompt to configure Cloud NAT.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-services/nat/list?project={{project-id}}` to explore Cloud NAT on the Google Cloud console.

To update VM with private IP, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 9: Update VM with private IP

Enter `9` at the `additional steps to perform` prompt to update VM with private IP.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instances?project={{project-id}}` to explore virtual machine instances on the console.

To create Cloud Storage bucket, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 10: Create Cloud Storage bucket

Enter `10` at the `additional steps to perform` prompt to create Cloud Storage bucket.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/storage/browser?project={{project-id}}` to explore Cloud Storage bucket on the console.

To configure Private Google Access, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 11: Configure Private Google Access

Enter `11` at the `additional steps to perform` prompt to configure Private Google Access.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/networking/networks/list?project={{project-id}}` to explore Private Google Access configuration on VPC network subnets.

To copy content of Cloud Storage bucket to VM with private IP, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 12: Copy content of Cloud Storage bucket to VM with private IP

Enter `12` at the `additional steps to perform` prompt to copy content of Cloud Storage bucket to VM with private IP.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/storage/browser?project={{project-id}}` to explore Cloud Storage bucket on the console.

Congratulations! You have completed the setup

Enter any key at the `$` prompt in the cloud shell terminal.
